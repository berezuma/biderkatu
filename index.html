<!DOCTYPE html>
<html lang="eu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Biderkatu! - Hizkuntza Anitzak</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.3s ease-in-out; }
        
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overscroll-behavior: none; /* Saihestu "bounce" efektua mugikorrean */
            font-family: system-ui, -apple-system, sans-serif;
            background-color: #f3f4f6;
        }
        #root {
            height: 100%;
            width: 100%;
            position: fixed; /* Edukia pantailara finkatu */
            overflow: hidden;
        }
        /* Scroll barra ezkutatu baina funtzionala mantendu (estetika) */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const translations = {
            eu: {
                title: "Biderkatu!",
                prompt: "Zer egin nahi duzu gaur?",
                study: "Ikasi",
                play: "Jolastu (Mix)",
                exam: "Azterketa",
                back: "Atzera",
                chooseTable: "Aukeratu taula bat",
                tableOf: "Taula: ",
                doExam: "Azterketa egin!",
                examTitle: "Azterketa: ",
                score: "Puntuak",
                correct: "Ondo!",
                wrong: "Erantzuna: ",
                done: "Amaitu duzu!",
                finalScore: "Azken puntuazioa",
                mainMenu: "Menu nagusia"
            },
            ca: {
                title: "A Multiplicar!",
                prompt: "Què vols fer avui?",
                study: "Estudiar",
                play: "Jugar (Mix)",
                exam: "Examen",
                back: "Tornar",
                chooseTable: "Tria una taula",
                tableOf: "Taula del ",
                doExam: "Fer examen!",
                examTitle: "Examen de la taula... ",
                score: "Punts",
                correct: "Molt bé!",
                wrong: "Era: ",
                done: "Has acabat!",
                finalScore: "Puntuació final",
                mainMenu: "Menú principal"
            },
            gl: {
                title: "A Multiplicar!",
                prompt: "Que queres facer hoxe?",
                study: "Estudar",
                play: "Xogar (Mix)",
                exam: "Facer Exame",
                back: "Volver",
                chooseTable: "Escolle unha táboa",
                tableOf: "Táboa do ",
                doExam: "Facer exame!",
                examTitle: "Exame da táboa... ",
                score: "Puntos",
                correct: "Moi ben!",
                wrong: "Era: ",
                done: "Remataches!",
                finalScore: "Puntuación final",
                mainMenu: "Menú principal"
            },
            es: {
                title: "¡A Multiplicar!",
                prompt: "¿Qué quieres hacer hoy?",
                study: "Estudiar",
                play: "Jugar (Mix)",
                exam: "Hacer Examen",
                back: "Volver",
                chooseTable: "Elige una tabla",
                tableOf: "Tabla del ",
                doExam: "¡Examen!",
                examTitle: "Examen de la tabla... ",
                score: "Puntos",
                correct: "¡Bien!",
                wrong: "Era: ",
                done: "¡Terminado!",
                finalScore: "Puntuación final",
                mainMenu: "Menú principal"
            },
            fr: {
                title: "Multiplication!",
                prompt: "Que veux-tu faire ?",
                study: "Étudier",
                play: "Jouer (Mix)",
                exam: "Examen",
                back: "Retour",
                chooseTable: "Choisis une table",
                tableOf: "Table de ",
                doExam: "Passer l'examen !",
                examTitle: "Examen de la table... ",
                score: "Points",
                correct: "Bravo !",
                wrong: "C'était: ",
                done: "Terminé !",
                finalScore: "Score final",
                mainMenu: "Menu principal"
            },
            en: {
                title: "Multiply!",
                prompt: "What to do today?",
                study: "Study",
                play: "Play (Mix)",
                exam: "Take Exam",
                back: "Back",
                chooseTable: "Choose a table",
                tableOf: "Table of ",
                doExam: "Start Exam!",
                examTitle: "Exam for table... ",
                score: "Score",
                correct: "Correct!",
                wrong: "Answer: ",
                done: "Well done!",
                finalScore: "Final score",
                mainMenu: "Main Menu"
            }
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [lang, setLang] = useState('eu');
            const [view, setView] = useState('menu');
            const [selectedTable, setSelectedTable] = useState(null);
            const [score, setScore] = useState(0);
            const [questionCount, setQuestionCount] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [feedback, setFeedback] = useState('none');
            const [inputAnswer, setInputAnswer] = useState('');
            const [examDeck, setExamDeck] = useState([]);
            const timerRef = useRef(null);

            const t = translations[lang];
            const langOrder = ['eu', 'ca', 'gl', 'es', 'fr', 'en'];

            const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            const generateQuizQuestion = useCallback(() => {
                const num1 = randomInt(2, 9);
                const num2 = randomInt(2, 9);
                const correct = num1 * num2;
                let options = new Set();
                options.add(correct);
                while (options.size < 3) {
                    const fake = correct + randomInt(-5, 5);
                    if (fake > 0 && fake !== correct) options.add(fake);
                }
                setCurrentQuestion({
                    num1, num2, correctAnswer: correct,
                    options: Array.from(options).sort(() => Math.random() - 0.5)
                });
            }, []);

            const generateExamQuestion = useCallback((table, index, deck) => {
                const currentDeck = deck || examDeck;
                if (!currentDeck || currentDeck.length === 0) return;
                const num2 = currentDeck[index];
                setCurrentQuestion({
                    num1: table, num2, correctAnswer: table * num2, options: []
                });
            }, [examDeck]);

            useEffect(() => {
                if (feedback === 'correct' || feedback === 'wrong') {
                    const delay = feedback === 'correct' ? 1000 : 1800;
                    timerRef.current = setTimeout(() => {
                        const limit = view === 'exam' ? examDeck.length : 10;
                        if (questionCount + 1 < limit) {
                            const nextIndex = questionCount + 1;
                            setQuestionCount(nextIndex);
                            setFeedback('none');
                            setInputAnswer('');
                            if (view === 'quiz') generateQuizQuestion();
                            else generateExamQuestion(selectedTable, nextIndex);
                        } else {
                            setView('results');
                        }
                    }, delay);
                }
                return () => { if (timerRef.current) clearTimeout(timerRef.current); };
            }, [feedback, questionCount, examDeck, view, selectedTable, generateQuizQuestion, generateExamQuestion]);

            const processAnswer = (isCorrect) => {
                if (feedback !== 'none') return;
                setFeedback(isCorrect ? 'correct' : 'wrong');
                if (isCorrect) setScore(s => s + 10);
            };

            const startQuiz = () => {
                setScore(0); setQuestionCount(0); setFeedback('none'); setInputAnswer('');
                generateQuizQuestion(); setView('quiz');
            };

            const startExam = (table) => {
                setScore(0); setQuestionCount(0); setFeedback('none'); setInputAnswer('');
                setSelectedTable(table);
                const newDeck = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].sort(() => Math.random() - 0.5);
                setExamDeck(newDeck);
                generateExamQuestion(table, 0, newDeck);
                setView('exam');
            };

            const goBackToMenu = () => {
                setScore(0); setQuestionCount(0); setFeedback('none'); setSelectedTable(null);
                setView('menu');
            };

            const handleNumpad = (val) => {
                if (feedback !== 'none') return;
                if (val === 'DEL') setInputAnswer(prev => prev.slice(0, -1));
                else if (val === 'ENTER') {
                    if (inputAnswer === '') return;
                    processAnswer(parseInt(inputAnswer) === currentQuestion.correctAnswer);
                }
                else if (inputAnswer.length < 3) setInputAnswer(prev => prev + val);
            };

            // Layout konpondua: Scrollbar kudeaketa eta overflow zuzena
            // ALDAKETA: 'justify-center' kendu da eta 'm-auto' gehitu da. 
            // Honek 1 eta 2 zenbakiak pantailaren goiko partean ezkutatzea ekiditen du mugikorrean.
            const ViewWrapper = ({ children, bgColor = "bg-white", className = "" }) => (
                <div className={`fixed inset-0 w-full h-full flex flex-col ${bgColor} ${className}`}>
                    {/* Eduki nagusia - Scrollable area */}
                    <div className="flex-1 w-full overflow-y-auto overflow-x-hidden p-2 md:p-4 scrollbar-hide flex flex-col">
                         {/* Spacer to center content vertically if screen is large enough, handled via m-auto. */}
                         <div className="w-full m-auto flex flex-col items-center p-2">
                            {children}
                         </div>
                    </div>
                    
                    {/* Footer - Fixed at bottom, never shrinks */}
                    <footer className="shrink-0 w-full py-2 text-[8px] md:text-[10px] text-gray-500 text-center leading-tight opacity-70 bg-white/30 backdrop-blur-sm z-10">
                        <p>© 2026 Beñat Erezuma. Lan hau <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.eu" target="_blank" rel="noopener noreferrer" className="underline">Creative Commons Aitortu-PartekatuBerdin 4.0 Nazioarteko Lizentzia</a> baten mende dago.</p>
                        <p className="mt-1">GitHub Pages-en ostatatuta.</p>
                    </footer>
                </div>
            );

            if (view === 'menu') return (
                <ViewWrapper bgColor="bg-gradient-to-b from-pink-100 to-purple-200" className="animate-in">
                    <div className="flex flex-col items-center justify-center w-full min-h-[min-content] py-4">
                        <div className="flex flex-wrap justify-center gap-2 mb-4 max-w-xs">
                            {langOrder.map(l => (
                                <button key={l} onClick={() => setLang(l)} className={`px-3 py-1.5 rounded-lg text-sm font-black uppercase tracking-widest transition-all ${lang === l ? 'bg-purple-600 text-white shadow-lg scale-110' : 'bg-white/60 text-purple-600 hover:bg-white'}`}>
                                    {l}
                                </button>
                            ))}
                        </div>
                        <h1 className="text-4xl md:text-6xl font-black text-purple-600 drop-shadow-md text-center mb-6">{t.title}</h1>
                        <div className="bg-white/80 backdrop-blur-sm p-6 rounded-[2rem] shadow-xl border-4 border-purple-300 w-full max-w-sm">
                            <p className="text-lg text-gray-600 mb-6 font-bold text-center">{t.prompt}</p>
                            <div className="space-y-3">
                                <button onClick={() => setView('learn')} className="w-full flex items-center justify-center gap-3 bg-blue-400 text-white text-xl font-bold py-4 rounded-2xl transition-all active:scale-95 shadow-md"><Icon name="book-open" /> {t.study}</button>
                                <button onClick={startQuiz} className="w-full flex items-center justify-center gap-3 bg-green-400 text-white text-xl font-bold py-4 rounded-2xl transition-all active:scale-95 shadow-md"><Icon name="gamepad-2" /> {t.play}</button>
                                <button onClick={() => setView('exam_menu')} className="w-full flex items-center justify-center gap-3 bg-orange-400 text-white text-xl font-bold py-4 rounded-2xl transition-all active:scale-95 shadow-md"><Icon name="calculator" /> {t.exam}</button>
                            </div>
                        </div>
                    </div>
                </ViewWrapper>
            );

            if (view === 'learn' && !selectedTable) return (
                <ViewWrapper bgColor="bg-blue-50" className="animate-in">
                    <div className="w-full max-w-lg flex flex-col items-center py-4">
                        <div className="w-full flex items-center justify-between mb-4 px-2">
                            <button onClick={goBackToMenu} className="text-gray-600 font-bold bg-white px-4 py-2 rounded-full shadow-md text-xs">{t.back}</button>
                            <h2 className="text-xl font-black text-gray-700">{t.chooseTable}</h2>
                            <div className="w-12"></div>
                        </div>
                        <div className="grid grid-cols-2 sm:grid-cols-5 gap-3 w-full">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                <button key={n} onClick={() => setSelectedTable(n)} className="aspect-square bg-white border-b-4 border-gray-200 rounded-2xl shadow-lg flex items-center justify-center text-4xl font-black text-gray-400 transition-all active:translate-y-1">{n}</button>
                            ))}
                        </div>
                    </div>
                </ViewWrapper>
            );

            if (view === 'learn' && selectedTable) return (
                <ViewWrapper bgColor="bg-blue-50" className="animate-in">
                    <div className="w-full max-w-md flex flex-col items-center py-2 h-full justify-start">
                        <div className="w-full flex justify-between items-center mb-2 px-1">
                            <button onClick={() => setSelectedTable(null)} className="text-blue-600 font-bold bg-white px-5 py-2 rounded-full shadow-sm text-sm">{t.back}</button>
                            <h2 className="text-xl md:text-2xl font-black text-blue-500 bg-white px-4 py-1 rounded-2xl shadow-sm border-b-2 border-blue-100">{t.tableOf}{selectedTable}</h2>
                        </div>
                        
                        {/* Scrollable list container */}
                        <div className="flex-1 w-full overflow-y-auto mb-3 bg-white rounded-3xl shadow-lg border-2 border-blue-100">
                             <div className="p-2">
                                {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                    <div key={n} className="flex justify-center items-center gap-6 text-lg font-bold text-gray-500 py-3 border-b border-dashed border-gray-100 last:border-0 px-4">
                                        <span className="w-24 text-right">{selectedTable} x {n}</span>
                                        <span className="text-blue-600 text-xl w-24 text-left">= {selectedTable * n}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <button onClick={() => startExam(selectedTable)} className="shrink-0 w-full bg-orange-400 text-white text-lg font-bold py-3 rounded-xl shadow-lg border-b-4 border-orange-600 mb-2">{t.doExam}</button>
                    </div>
                </ViewWrapper>
            );

            if (view === 'exam_menu') return (
                <ViewWrapper bgColor="bg-orange-50" className="animate-in">
                    <div className="w-full max-w-lg flex flex-col items-center py-4">
                        <div className="w-full flex items-center justify-between mb-4 px-2">
                            <button onClick={goBackToMenu} className="text-gray-600 font-bold bg-white px-4 py-2 rounded-full shadow-md text-xs">{t.back}</button>
                            <h2 className="text-xl font-black text-orange-600">{t.examTitle}</h2>
                            <div className="w-12"></div>
                        </div>
                        <div className="grid grid-cols-2 sm:grid-cols-5 gap-3 w-full">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                <button key={n} onClick={() => startExam(n)} className="aspect-square bg-white border-b-4 border-gray-200 rounded-2xl shadow-lg flex items-center justify-center text-4xl font-black text-gray-400 transition-all active:translate-y-1">{n}</button>
                            ))}
                        </div>
                    </div>
                </ViewWrapper>
            );

            if (view === 'quiz' || view === 'exam') {
                if (!currentQuestion) return null;
                const isExam = view === 'exam';
                const total = isExam ? examDeck.length : 10;
                return (
                    <ViewWrapper bgColor={isExam ? 'bg-orange-50' : 'bg-green-50'}>
                        <div className="w-full max-w-md flex justify-between items-center bg-white p-3 rounded-xl shadow-sm mb-4 shrink-0">
                            <button onClick={goBackToMenu} className="text-gray-400"><Icon name="arrow-left" size={20} /></button>
                            <div className="flex items-center gap-1 text-yellow-500 font-black text-lg"><Icon name="star" size={20} /> {score}</div>
                            <div className={`font-bold px-3 py-1 rounded-lg text-sm ${isExam ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600'}`}>{questionCount + 1} / {total}</div>
                        </div>
                        
                        <div className={`bg-white rounded-[2rem] p-6 shadow-xl text-center border-b-[8px] w-full max-w-sm relative shrink-0 flex flex-col justify-center transition-all mb-4 ${feedback === 'correct' ? 'border-green-400' : feedback === 'wrong' ? 'border-red-400 shake' : isExam ? 'border-orange-200' : 'border-green-200'}`}>
                            {feedback === 'correct' && <div className="absolute -top-4 left-0 right-0 flex justify-center"><span className="bg-green-500 text-white font-black px-6 py-1 rounded-full shadow-lg text-sm">{t.correct}</span></div>}
                            {feedback === 'wrong' && <div className="absolute -top-4 left-0 right-0 flex justify-center"><span className="bg-red-500 text-white font-black px-6 py-1 rounded-full shadow-lg text-sm">{t.wrong}{currentQuestion.correctAnswer}</span></div>}
                            <div className="text-6xl font-black text-gray-700 flex justify-center gap-3">
                                <span>{currentQuestion.num1}</span>
                                <span className="text-gray-200">×</span>
                                <span>{currentQuestion.num2}</span>
                            </div>
                            <div className="mt-6 flex justify-center h-16">
                                {isExam ? (
                                    <div className={`text-5xl font-black px-6 rounded-xl border-4 min-w-[120px] flex items-center justify-center ${feedback === 'none' ? 'bg-gray-50 border-orange-100' : feedback === 'correct' ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'}`}>
                                        {inputAnswer}<span className={feedback === 'none' ? 'animate-pulse text-gray-200' : 'hidden'}>|</span>
                                    </div>
                                ) : (
                                    <div className="text-4xl font-black text-gray-200 bg-gray-50 px-6 py-1 rounded-xl border-2 border-gray-100">= ?</div>
                                )}
                            </div>
                        </div>

                        <div className="w-full max-w-sm shrink-0 pb-4">
                            {!isExam ? (
                                <div className="grid gap-3">
                                    {currentQuestion.options.map((opt, i) => (
                                        <button key={i} disabled={feedback !== 'none'} onClick={() => processAnswer(opt === currentQuestion.correctAnswer)} className={`py-4 rounded-xl text-3xl font-black shadow-md border-b-4 transition-all ${feedback === 'none' ? 'bg-white hover:bg-green-50 border-gray-200' : opt === currentQuestion.correctAnswer ? 'bg-green-500 text-white border-green-700' : 'bg-white text-gray-200'}`}>
                                            {opt}
                                        </button>
                                    ))}
                                </div>
                            ) : (
                                <div className="grid grid-cols-3 gap-2">
                                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => (
                                        <button key={n} onClick={() => handleNumpad(n.toString())} className="bg-white text-orange-600 text-2xl font-black py-3 rounded-xl border-b-2 border-orange-100 active:bg-orange-50">{n}</button>
                                    ))}
                                    <button onClick={() => handleNumpad('DEL')} className="bg-red-50 text-red-500 flex items-center justify-center rounded-xl border-b-2 border-red-100"><Icon name="delete" size={24} /></button>
                                    <button onClick={() => handleNumpad('0')} className="bg-white text-orange-600 text-2xl font-black py-3 rounded-xl border-b-2 border-orange-100">0</button>
                                    <button onClick={() => handleNumpad('ENTER')} className="bg-green-400 text-white flex items-center justify-center rounded-xl border-b-2 border-green-600"><Icon name="check" size={32} /></button>
                                </div>
                            )}
                        </div>
                    </ViewWrapper>
                );
            }

            if (view === 'results') return (
                <ViewWrapper bgColor="bg-purple-50" className="justify-center animate-in">
                    <div className="bg-white p-8 rounded-[2rem] shadow-2xl max-w-sm w-full border-4 border-purple-200 text-center my-auto">
                        <Icon name="trophy" size={60} className="text-yellow-400 mx-auto mb-4" />
                        <h2 className="text-3xl font-black text-purple-600 mb-4">{t.done}</h2>
                        <div className="bg-purple-50 rounded-2xl p-6 mb-6 border-2 border-purple-100">
                            <div className="text-xs text-purple-400 font-black uppercase mb-1">{t.finalScore}</div>
                            <div className="text-6xl font-black text-purple-600">{score}</div>
                        </div>
                        <button onClick={goBackToMenu} className="w-full bg-purple-500 text-white font-bold py-4 rounded-xl text-lg shadow-lg border-b-4 border-purple-700">{t.mainMenu}</button>
                    </div>
                </ViewWrapper>
            );

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
