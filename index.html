<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡A Multiplicar! - App Web</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.3s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Mock Lucide components for standalone HTML
        const Icon = ({ name, size = 24, fill = "none", strokeWidth = 2, className = "" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [selectedTable, setSelectedTable] = useState(null);
            const [score, setScore] = useState(0);
            const [questionCount, setQuestionCount] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [feedback, setFeedback] = useState('none');
            const [inputAnswer, setInputAnswer] = useState('');
            const [examDeck, setExamDeck] = useState([]);
            const timerRef = useRef(null);

            const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            useEffect(() => {
                if (view === 'quiz') {
                    generateQuizQuestion();
                } else if (view === 'exam' && selectedTable) {
                    generateExamQuestion(selectedTable);
                }
            }, [view, questionCount, selectedTable]);

            useEffect(() => {
                if (feedback === 'correct' || feedback === 'wrong') {
                    const delay = feedback === 'correct' ? 1500 : 2000;
                    timerRef.current = setTimeout(() => {
                        const limit = view === 'exam' ? examDeck.length : 10;
                        if (questionCount < limit - 1) {
                            setQuestionCount(prev => prev + 1);
                            setFeedback('none');
                            setInputAnswer('');
                        } else {
                            setView('results');
                        }
                    }, delay);
                }
                return () => { if (timerRef.current) clearTimeout(timerRef.current); };
            }, [feedback, questionCount, examDeck.length, view]);

            const generateQuizQuestion = () => {
                const num1 = randomInt(2, 9);
                const num2 = randomInt(2, 9);
                const correct = num1 * num2;
                let options = new Set();
                options.add(correct);
                while (options.size < 3) {
                    const fake = correct + randomInt(-10, 10);
                    if (fake > 0 && fake !== correct) options.add(fake);
                }
                setCurrentQuestion({
                    num1, num2, correctAnswer: correct,
                    options: Array.from(options).sort(() => Math.random() - 0.5)
                });
            };

            const generateExamQuestion = (table) => {
                if (examDeck.length === 0) return;
                const num2 = examDeck[questionCount];
                if (num2 === undefined) return;
                setCurrentQuestion({
                    num1: table, num2, correctAnswer: table * num2, options: []
                });
            };

            const handleQuizAnswer = (answer) => {
                if (!currentQuestion || feedback !== 'none') return;
                processAnswer(answer === currentQuestion.correctAnswer);
            };

            const handleExamSubmit = () => {
                if (!currentQuestion || inputAnswer === '' || feedback !== 'none') return;
                processAnswer(parseInt(inputAnswer) === currentQuestion.correctAnswer);
            };

            const processAnswer = (isCorrect) => {
                setFeedback(isCorrect ? 'correct' : 'wrong');
                if (isCorrect) setScore(s => s + 10);
            };

            const resetGame = () => {
                setScore(0); setQuestionCount(0); setFeedback('none');
                setInputAnswer(''); setCurrentQuestion(null); setExamDeck([]);
                if (timerRef.current) clearTimeout(timerRef.current);
            };

            const startQuiz = () => { resetGame(); setView('quiz'); };
            const startExam = (table) => {
                resetGame(); setSelectedTable(table);
                setExamDeck([2, 3, 4, 5, 6, 7, 8, 9, 10].sort(() => Math.random() - 0.5));
                setView('exam');
            };

            const goBackToMenu = () => { resetGame(); setView('menu'); };

            const handleNumpad = (val) => {
                if (feedback !== 'none') return;
                if (val === 'DEL') setInputAnswer(prev => prev.slice(0, -1));
                else if (val === 'ENTER') handleExamSubmit();
                else if (inputAnswer.length < 3) setInputAnswer(prev => prev + val);
            };

            if (view === 'menu') return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-pink-100 to-purple-200 p-4 space-y-8 animate-in">
                    <h1 className="text-5xl md:text-6xl font-black text-purple-600 drop-shadow-md text-center">¡A Multiplicar!</h1>
                    <div className="bg-white/80 backdrop-blur-sm p-8 rounded-[2rem] shadow-xl border-4 border-purple-300 w-full max-w-md">
                        <p className="text-xl text-gray-600 mb-8 font-bold text-center">¿Qué quieres hacer hoy?</p>
                        <div className="space-y-4">
                            <button onClick={() => setView('learn')} className="w-full flex items-center justify-center gap-4 bg-blue-400 hover:bg-blue-500 text-white text-2xl font-bold py-5 rounded-2xl transition-all hover:scale-105 active:scale-95"><Icon name="book-open" /> Estudiar Tablas</button>
                            <button onClick={startQuiz} className="w-full flex items-center justify-center gap-4 bg-green-400 hover:bg-green-500 text-white text-2xl font-bold py-5 rounded-2xl transition-all hover:scale-105 active:scale-95"><Icon name="gamepad-2" /> Jugar (Mix)</button>
                            <button onClick={() => setView('exam_menu')} className="w-full flex items-center justify-center gap-4 bg-orange-400 hover:bg-orange-500 text-white text-2xl font-bold py-5 rounded-2xl transition-all hover:scale-105 active:scale-95"><Icon name="calculator" /> Hacer Examen</button>
                        </div>
                    </div>
                </div>
            );

            if (view === 'learn' && !selectedTable) return (
                <div className="min-h-screen bg-blue-50 p-4 animate-in">
                    <div className="max-w-4xl mx-auto">
                        <button onClick={goBackToMenu} className="mb-8 flex items-center text-gray-600 font-bold bg-white px-6 py-3 rounded-full shadow-md">Volver</button>
                        <h2 className="text-3xl font-black text-center mb-8">Elige una tabla</h2>
                        <div className="grid grid-cols-2 sm:grid-cols-5 gap-4">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                <button key={n} onClick={() => setSelectedTable(n)} className="aspect-square bg-white border-b-8 border-gray-200 hover:border-purple-300 rounded-3xl shadow-lg flex items-center justify-center text-5xl font-black text-gray-400 hover:text-purple-500 transition-all">{n}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (view === 'learn' && selectedTable) return (
                <div className="min-h-screen bg-blue-50 p-4 animate-in">
                    <div className="max-w-md mx-auto flex flex-col items-center">
                        <button onClick={() => setSelectedTable(null)} className="self-start mb-6 flex items-center text-blue-600 font-bold bg-white px-6 py-3 rounded-full shadow-sm">Tablas</button>
                        <h2 className="text-4xl font-black text-blue-500 mb-6 bg-white px-10 py-4 rounded-3xl shadow-lg border-b-4 border-blue-100">Tabla del {selectedTable}</h2>
                        <div className="bg-white p-4 rounded-[2rem] shadow-xl border-4 border-blue-100 w-full mb-6">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                <div key={n} className="flex justify-between items-center text-2xl font-bold text-gray-500 py-3 border-b border-dashed border-gray-100 last:border-0 px-4">
                                    <span>{selectedTable} x {n}</span>
                                    <span className="text-blue-600 text-3xl">= {selectedTable * n}</span>
                                </div>
                            ))}
                        </div>
                        <button onClick={() => startExam(selectedTable)} className="w-full bg-orange-400 hover:bg-orange-500 text-white text-2xl font-bold py-5 rounded-2xl shadow-lg border-b-4 border-orange-600 transition-all active:translate-y-1">¡Examen de la tabla {selectedTable}!</button>
                    </div>
                </div>
            );

            if (view === 'exam_menu') return (
                <div className="min-h-screen bg-orange-50 p-4 animate-in">
                    <div className="max-w-4xl mx-auto">
                        <button onClick={goBackToMenu} className="mb-8 flex items-center text-gray-600 font-bold bg-white px-6 py-3 rounded-full shadow-md">Volver</button>
                        <h2 className="text-3xl font-black text-center mb-8">Examen de la tabla...</h2>
                        <div className="grid grid-cols-2 sm:grid-cols-5 gap-4">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                                <button key={n} onClick={() => startExam(n)} className="aspect-square bg-white border-b-8 border-gray-200 hover:border-orange-300 rounded-3xl shadow-lg flex items-center justify-center text-5xl font-black text-gray-400 hover:text-orange-500 transition-all">{n}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (view === 'quiz' || view === 'exam') {
                if (!currentQuestion) return null;
                const isExam = view === 'exam';
                const total = isExam ? examDeck.length : 10;
                return (
                    <div className={`min-h-screen ${isExam ? 'bg-orange-50' : 'bg-green-50'} p-4 flex flex-col items-center`}>
                        <div className="w-full max-w-lg flex justify-between items-center mb-8 bg-white p-4 rounded-2xl shadow-sm">
                            <button onClick={goBackToMenu} className="text-gray-400"><Icon name="arrow-left" /></button>
                            <div className="flex items-center gap-2 text-yellow-500 font-black text-2xl"><Icon name="star" fill="currentColor" /> {score}</div>
                            <div className={`font-bold px-4 py-2 rounded-lg ${isExam ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600'}`}>{questionCount + 1} / {total}</div>
                        </div>
                        <div className={`bg-white rounded-[2.5rem] p-10 shadow-2xl text-center border-b-[12px] w-full max-w-md relative mb-8 transition-all ${feedback === 'correct' ? 'border-green-400' : feedback === 'wrong' ? 'border-red-400 shake' : isExam ? 'border-orange-200' : 'border-green-200'}`}>
                            {feedback === 'correct' && <div className="absolute -top-6 left-0 right-0 flex justify-center"><span className="bg-green-500 text-white font-black px-8 py-2 rounded-full shadow-lg animate-bounce">¡Bien!</span></div>}
                            {feedback === 'wrong' && <div className="absolute -top-6 left-0 right-0 flex justify-center"><span className="bg-red-500 text-white font-black px-8 py-2 rounded-full shadow-lg animate-pulse">Era {currentQuestion.correctAnswer}</span></div>}
                            <div className="text-7xl font-black text-gray-700 flex justify-center gap-4"><span>{currentQuestion.num1}</span><span className="text-gray-300">×</span><span>{currentQuestion.num2}</span></div>
                            <div className="mt-8 flex justify-center h-20">
                                {isExam ? (
                                    <div className={`text-6xl font-black px-8 rounded-2xl border-4 min-w-[160px] flex items-center justify-center ${feedback === 'none' ? 'bg-gray-50 border-orange-100' : feedback === 'correct' ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'}`}>{inputAnswer}<span className={feedback === 'none' ? 'animate-pulse text-gray-300' : 'hidden'}>|</span></div>
                                ) : <div className="text-5xl font-black text-gray-200 bg-gray-50 px-8 py-2 rounded-2xl border-4 border-gray-100">= ?</div>}
                            </div>
                        </div>
                        <div className="w-full max-w-md">
                            {!isExam ? (
                                <div className="grid gap-4">{currentQuestion.options.map((opt, i) => (
                                    <button key={i} disabled={feedback !== 'none'} onClick={() => handleQuizAnswer(opt)} className={`py-6 rounded-2xl text-4xl font-black shadow-md border-b-8 transition-all ${feedback === 'none' ? 'bg-white hover:bg-green-50 border-gray-200' : opt === currentQuestion.correctAnswer ? 'bg-green-500 text-white border-green-700' : 'bg-white text-gray-200'}`}>{opt}</button>
                                ))}</div>
                            ) : (
                                <div className="grid grid-cols-3 gap-3">
                                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => <button key={n} onClick={() => handleNumpad(n.toString())} className="bg-white text-orange-600 text-4xl font-black py-5 rounded-2xl shadow-sm border-b-4 border-orange-100 active:translate-y-1">{n}</button>)}
                                    <button onClick={() => handleNumpad('DEL')} className="bg-red-50 text-red-500 flex items-center justify-center rounded-2xl shadow-sm border-b-4 border-red-100"><Icon name="delete" size={32} /></button>
                                    <button onClick={() => handleNumpad('0')} className="bg-white text-orange-600 text-4xl font-black py-5 rounded-2xl shadow-sm border-b-4 border-orange-100">0</button>
                                    <button onClick={() => handleNumpad('ENTER')} className="bg-green-400 text-white flex items-center justify-center rounded-2xl shadow-sm border-b-4 border-green-600"><Icon name="check" size={40} /></button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (view === 'results') return (
                <div className="min-h-screen bg-purple-50 flex flex-col items-center justify-center p-4 animate-in">
                    <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl max-w-md w-full border-4 border-purple-200 text-center">
                        <Icon name="trophy" size={100} className="text-yellow-400 mx-auto mb-8" fill="currentColor" />
                        <h2 className="text-4xl font-black text-purple-600 mb-2">¡Terminaste!</h2>
                        <div className="bg-purple-50 rounded-3xl p-8 my-8 border-2 border-purple-100"><div className="text-xs text-purple-400 font-black uppercase mb-2">Puntuación Final</div><div className="text-7xl font-black text-purple-600">{score}</div></div>
                        <button onClick={() => setView('menu')} className="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-5 rounded-2xl text-xl shadow-lg border-b-4 border-purple-700">Volver al Menú</button>
                    </div>
                </div>
            );

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
